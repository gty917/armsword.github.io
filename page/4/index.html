<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 4 页 | armsword的涅槃之地</title>
  <meta name="author" content="armsword">
  
  <meta name="description" content="程序员,搜索引擎,网络编程,后台开发,北邮人,阿里巴巴,神马搜索,Linux,C,C++,Python">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="armsword的涅槃之地"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon" type="image/x-ico"> 
  <link rel="alternate" href="/atom.xml" title="armsword的涅槃之地" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">armsword的涅槃之地</a></h1>
  <h2><a href="/">莫思身外无穷事，且读生平未见书 || 不为无益之事，何以遣有涯之生</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about-me">About</a></li>
    
      <li><a href="/document-information">文档资料</a></li>
    
  <li><a href="/atom.xml">RSS</a><li>
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-02-13T17:05:21.000Z"><a href="/2014/02/14/tcp-and-udp-note/">2月 14 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/02/14/tcp-and-udp-note/">记录下传输层协议TCP和UDP的一些特性</a></h1>
  

    </header>
    <div class="entry">
      
        <p>在TCP/IP中能够实现传输层功能的、具有代表性的协议是TCP和UDP。</p>
<p>一、TCP：</p>
<p>TCP是面向连接的、可靠的流协议。流就是指不间断的数据结构，你可以把它想象成排水道中的水流。当应用程序采用TCP发送消息时，虽然可以保证发送的顺序，但还是犹如没有任何间隔的数据流发送给接收端。TCP充分地实现了数据传输时各种控制功能，可以进行丢包时的重发控制，还可以对次序乱掉的分包进行顺序控制。而这些在UDP中都没有。此外，TCP作为一种面向有连接的协议，只有在确认通信对端存在时才会发送数据，从而可以控制通信流量的浪费。根据TCP的这些机制，在IP这种无连接的网络上也能够实现高可靠性的通信。</p>
<p>TCP为提供可靠性传输，实行“顺序控制”或“重发控制”机制。此外还具备“流控制（流量控制）”、“拥塞控制”、提供网络利用率等众多功能。</p>
<p>TCP通过检验和、序列号、确认应答、重发控制、连接管理以及窗口控制等机制实现可靠性传输。</p>
<p>(1)通过序列号与确认应答提高可靠性</p>
<p>在TCP中，当发送端的数据到达接收主机时，接收端主机会返回一个已收到消息的通知。这个消息叫做确认应答（ACK）。</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140214001551.jpg" alt=""></p>
<p>TCP通过肯定的确认应答（ACK）实现可靠的数据传输。当发送端将数据发出之后会等待对端的确认应答。如果有确认应答，说明数据已经成功到达对端。反之，则数据丢失的可能性很大。在一定时间内没有等到确认应答，发送端就可以认为数据已经丢失，并进行重发。由此，即使产生了丢包，仍然能够保证数据能够到达对端，实现可靠传输。未收到确认应答并不意味着数据一定丢失。也有可能是数据对方已经收到，只是返回的确认应答在途中丢失。这种情况也会导致发送端因没有收到确认应答，而认为数据没有到达目的地，从而进行重新发发送。</p>
<p>上述这些确认应答处理、重发控制以及重复控制等功能都可以通过序列号实现。序列号是按顺序给发送数据的每一个字节（8位字节）都标上号码的编号。接收端查询接收数据TCP首部中的序列号和数据的长度，将自己下一步应该接收的序号作为确认应答返送回去。就这样，通过序列号和确认应答号，TCP可以实现可靠传输。</p>
<p>(2)重发超时如何确实</p>
<p>重发超时是指在重发数据之前，等待确认应答到来的那个特定时间间隔。如果超过了这个时间仍未收到确认应答，发送端将进行数据重发。那么这个重发超时的具体时间长度又是如何确定的呢？</p>
<p>最理想的是，找到一个最小时间，它能保证“确认应答一定能在这个时间内返回”。然而这个时间长短随着数据包途径的网络环境的不同而有所变化。例如在高速的LAN中时间相对较短，而在长距离的通信当中应该比LAN要长一些。即使是在同一个网络中，根据不同时段的网络堵塞程度时间的长短也会发生变化。TCP要求不论处在何种网络环境下都要提供高性能通信，并且无论网络拥堵情况发生何种变化，都必须保持这一特性。为此，它在每次发包时都会计算往返时间及其偏差。将这个往返时间和偏差相加重发超时的时间，就是比这个总和要稍大一点的值。</p>
<p>在BSD的Unix以及Windows系统中，超时都以0.5秒为单位进行控制，因此重发超时都是0.5秒的整数倍。不过，由于最初的数据包还不知道往返时间，所以其重发超时一般设置为6秒左右。数据被重发之后若还是收不到确认应答，则进行再次发送。此时，等待确认应答的时间将会以2倍、4倍的指数函数延长。此外，数据也不会被无限、反复地重发。达到一定重发次数之后，如果仍没有任何确认应答返回，就会判断为网络或对端主机发生了异常，强制关闭连接。并且通知应用通信异常强行终止。</p>
<p>(3)连接管理</p>
<p>UDP是一种面向无连接的通信协议，因此不检查对端是否可以通信，直接将UDP包发送出去。TCP与此相反，它会在数据通信之前，通过TCP首部发送一个SYN包作为建立连接的请求等待确认应答。如果对端发来确认应答，则认为可以进行数据通信。如果对端的确认应答未能到达，就不会进行数据通信。此外，在通信结束时会进行断开连接的处理（FIN包）。</p>
<p>可以使用TCP首部用于控制的字段来管理TCP连接。一个连接的建立与断开，正常过程至少需要来回发送7个包才能完成。</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140214001552.jpg" alt=""></p>
<p>(4)TCP以段为单位发送数据</p>
<p>在建立TCP连接的同时，也可以确认发送数据包的单位，我们也可以称其为“最大消息长度”（MSS：Maximum Segment Size）。最理想的情况是，最大消息长度正好是IP中不会被分片处理的最大数据长度。</p>
<p>TCP在传送大量数据时，是以MSS的大小将数据进行分割发送。进行重发时也是以MSS为单位。</p>
<p>MSS是在三次握手的时候，在两端主机之间被计算得出。两端的主机在发出建立连接的请求时，会在TCP首部中写入MSS选项，告诉对方自己的接口能够适应MSS的大小。然后会在两者之间选择一个较小的值投入使用。</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140214001553.jpg" alt=""></p>
<p>(5)利用窗口控制提高速度</p>
<p>TCP以1个段为单位，每发一个段进行一次确认应答的处理，这样的传输方式有一个缺点，那就是，包的往返时间越长通信性能就越低。</p>
<p>为解决这个问题，TCP引入了窗口这个概念。即使在往返时间较长的情况下，它也能控制网络性能的下降。确认应答不再是以每个分段，而是以更大的单位进行确认时，转发时间将会大幅度的缩短。也就是说，发送端主机，在发送了一个段以后不必要一直等待确认应答，而是继续发送。</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140214001554.jpg" alt=""></p>
<p>窗口大小就是无需等待确认应答而可以继续发送数据的最大值，如上，窗口大小为4个段。这个机制实现了使用大量的缓冲区，通过对多个段同时进行确认应答的功能。</p>
<p>收到确认应答的情况下，将窗口滑动到确认应答中的序列号的位置。这样可以顺序地将多个段同时发送提高通信性能。这种机制也被成为滑动窗口控制。</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140214001555.jpg" alt=""></p>
<p>(6)流控制</p>
<p>发送端根据自己的实际情况发送数据。但是，接收端可能收到的是一个毫无关系的数据包又可能会在处理其他问题上花费一些时间。因此在为这个数据包做其他处理时会耗费一些时间，甚至在高负荷的情况下无法接收任何数据。如此一来，如果接收端将本应该接收的数据丢弃的话，就又会触发重发机制，从而导致网络流量的无端浪费。</p>
<p>为了防止这种现象的发生，TCP提供一种机制可以让发送端根据接收端的实际接收能力控制发送的数据量。这就是所谓的流控制。它的具体操作是，接收端主机向发送端主机通知自己可以接收数据的大小，于是发送端会发送不超过这个限度的数据。该大小限度就被称作窗口大小。</p>
<p>TCP首部中，专门有一个字段用来通知窗口大小。接收主机将自己可以接收的缓冲区大小放入这个字段中通知给发送端。这个字段的值越大，说明网络的吞吐量越高。</p>
<p>不过，接收端的这个缓冲区一旦面临数据溢出时，窗口大小的值也会随之被设置为一个更小的值通知给发送端，从而控制数据发送量。也就是说，发送端主机会根据接收端主机的指示，对发送数据的量进行控制。这也就形成了一个完整的TCP流控制（流量控制）。</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140214114741.jpg" alt=""></p>
<p>(7)拥塞控制</p>
<p>有了TCP的窗口控制，收发主机之间即使不再以一个数据段为单位发送确认应答，也能够连续发送大量数据包。然而，如果在通信刚开始时就发送大量数据，也可能会引发其他问题。在网络出现堵塞时，如果突然发送一个较大量的数据，极有可能导致整个网络的瘫痪。TCP为了防止该问题的出现，在通信一开始时就会通过一个叫做慢启动的算法得出的数值，对发送数据量进行控制。</p>
<p>首先，为了在发送端调节所要发送数据的量，定义了一个叫做“拥塞窗口”的概念。于是在慢启动的时候，将这个拥塞窗口的大小设置为1个数据段（1MSS）发送数据，之后每收到一次确认应答（ACK），拥塞窗口的值就加1.在发送数据包时，将拥塞窗口的大小与接收端主机通知的窗口大小做比较，然后按照它们当中较小的那个值，发送比其还要小的数据量。</p>
<p>(8)提高网络利用率的规范</p>
<p>Nagle算法：</p>
<p>TCP中为了提高网络的利用率，经常使用一个叫做Nagle的算法。该算法是指发送端即使还有应该发送的数据，但如果这部分数据很少的话，则进行延迟发送的一种处理机制。具体来说，就是仅在下列任意一种条件下才能发送数据。如果两个条件都不满足，那么暂时等待一段时间以后再进行数据发送。</p>
<p>1&gt;已发送的数据都已经收到确认应答时</p>
<p>2&gt;可以发送最大段长度（MSS）的数据时</p>
<p>延迟确认应答：</p>
<p>当某个接收端收到这个小窗口的通知以后，会以它为上限发送数据，从而又降低了网络的利用率。为此，引入了一个方法，那就是收到数据以后并不立即返回确认应答，而是延迟一段时间的机制。</p>
<p>捎带应答：</p>
<p>捎带应答是指在同一个TCP包中既发送数据又发送确认应答的一种机制。由此，网络的利用率会提高，计算机的负荷也会减轻。不过，确认应答必须得等到应用处理完数据并将作为回执的数据返回为止，才能进行捎带应答。</p>
<p>二、UDP：</p>
<p>UDP是User Datagram Protocol的缩写。UDP是不具有可靠性的数据报协议。细微的处理它会交给上层的应用去完成。在UDP的情况下，虽然可以确保发送消息的大小，却不能保证消息一定会到达。因此，应用有时会根据自己的需要进行重发处理。</p>
<p>UDP不提供复杂的控制机制，利用IP提供面向无连接的通信服务。并且它是将应用程序发来的数据在收到的那一刻，立即按照原样发送到网络上的一种机制。</p>
<p>即使是出现网络堵塞的情况下，UDP也无法进行流量控制等避免网络拥塞的行为。此外，传输途中即使出现丢包，UDP也不负责重发。甚至当出现包的到达顺序乱掉时也没有纠正的功能。如果需要这些细节控制，那么不得不交由采用UDP的应用程序去处理。UDP有点类似于用户说什么听什么的机制，但是需要用户充分考虑好上层协议类型并制作相应的应用程序。因此，也可以说，UDP按照“制造程序的那些用户的指示行事”。</p>
<p>由于UDP面向无连接，它可以随时发送数据。再加上UDP本身的处理既简单又高效，因此经常用于以下几个方面：</p>
<p>1&gt;包总量较少的通信（DNS、SNMP等）</p>
<p>2&gt;视频、音频等多媒体通信（即时通信）</p>
<p>3&gt;限定于LAN等特定网络中的应用通信</p>
<p>4&gt;广播通信（广播、多播）</p>
<p>可能有人会认为，鉴于TCP是可靠的传输协议，那么它一定优于UDP。其实不然。TCP与UDP的优缺点无法简单地、绝对地去做比较。那么，对这两种协议应该如何加以区分使用呢？下面，我就对此问题做一简单说明。</p>
<p>TCP用于在传输层有必要实现可靠的情况。由于它是面向有连接并具备顺序控制、重发控制等机制的，所以它可以为应用提供可靠传输。</p>
<p>而UDP主要用于那些对高速传输和实时性有较高要求的通信或广播通信。我们拿通过IP电话进行通话作为例子。如果使用TCP，数据在传送途中如果丢失会重发，但这样无法刘畅地传输通话人的声音，会导致无法进行正常交流。而采用UDP，它不会进行重发处理。从而也就不会有声音大幅度延迟到达的问题。即使有部分数据丢失，也只是会影响某一小部分的通话。此外，在多播与广播通信中也使用UDP而不是TCP。RIP、DHCP等基于广播的协议也要依赖于UDP。因此，TCP和UDP应该根据应用的目的按需使用。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-02-13T08:34:57.000Z"><a href="/2014/02/13/osi-model-communicate-example/">2月 13 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/02/13/osi-model-communicate-example/">OSI参考模型通信处理举例</a></h1>
  

    </header>
    <div class="entry">
      
        <p>我们以生活中最常见的发送邮件作为例子。假定用户A要给用户B发送一封内容为“早上好”邮件。网络究竟会进行哪些处理呢？我们由上至下进行分析。</p>
<p>应用层：</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/201402131508201.jpg" alt=""></p>
<p>用户A在主机上新建一封电子邮件，指定收件人为B，并输入邮件内容为“早上好”。收发邮件的这款软件从功能上可以分为两大类：一部分是与通信相关的，另一部分是与通信无关的。例如用户A从键盘输入“早上好”的这一部分就属于与通信无关的功能，而将“早上好”的内容发送给收件人B 则是其与通信相关的功能。因此，此处的“输入电子邮件内容后发送给目标地址”也就相当于应用层。</p>
<p>从用户输入完所要发送的内容并点击“发送”按钮的那一刻开始，就进入了应用层协议的处理。该协议会在所要传送数据的前端附加一个首部（标签）信息。该首部标明了邮件内容为“早上好”和收件人为“B”。这一附有首部信息的数据传送给主机B以后由该主机上的收发邮件软件通过“收信”功能获取内容。主机B 上的应用收到主机A发过来的数据后，分析其数据首部与数据正文，并将邮件保存到硬盘或是其他非易失性存储器以备进行相应的处理。如果主机B 上收件人的邮箱空间已满无法接收新的邮件，则会返回一个错误给发送方。对这类异常的处理也正属于应用层需要解决的问题。</p>
<p>表示层：</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140213150820.jpg" alt=""></p>
<p>表示层的“表示”有“表现”、“演示”的意思，因此更关注数据的具体表现形式。此外，所使用的应用软件本身的不同也会导致数据的表现形式截然不同。例如有的字处理软件创建的文件只能由该字处理厂商所提供的特定版本的软件才来打开读取。</p>
<p>那么，电子邮件中如果遇到此类问题该如何解决呢？如果用户A与用户B所使用的邮件客户端软件完全一致，就能够顺利收取和阅读邮件，不会遇到类似的问题。但是这在现实生活当中是不大可能的。让所有用户千篇一律地使用同一款客户端软件对使用者来说也是极不方便的一件事情。</p>
<p>解决这类问题有以下几种方法。首先是利用表示层，将数据从“某个计算机特定的数据格式”转换为“网络通用的标准数据格式”后再发送出去。接收端主机收到数据以后将这些网络标准格式的数据恢复为“该计算机特定的数据格式”，然后再进行相应的处理。</p>
<p>在前面这个例子中，由于数据被转换为通用标准的格式后再进行处理，使得异构的机型之间也能保持数据的一致性。这也正是表示层的作用所在。即表示层是进行“统一的网络数据格式”与“某一台计算机或某一款软件特有的数据格式”之间相互转换的分层。</p>
<p>此例中的“早上好”这段文字根据其编码格式被转换成为了“统一的网络数据格式”。即便是一段简单的文字流，也可以有众多复杂的编码格式。就拿文字来说，有UTF-8、UTF-16 ISO-XXX等很多编码格式。如果未能按照特定格式编码，那么在接收端就是收到邮件也可能会是乱码。表示层与表示层之间为了识别编码格式也会附加首部信息，从而将实际传输的数据转交给下一层去处理。</p>
<p>会话层：</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140213150821.jpg" alt=""></p>
<p>下面，我们来分析在两端主机的会话层之间是如何高效地进行数据交互、采用何种方法传输数据的。</p>
<p>假定用户A新建了5封电子邮件准备发给用户B。这5封邮件的发送顺序可以有很多种。例如，可以每发一封邮件时建立一次连接，随后断开连接。还可以一经建立好连接后就将5封邮件连续发送给对方。甚至可以同时建立好5个连接，将5封邮件同时发送给对方。决定采用何种连接方法是会话层的主要责任。</p>
<p>会话层也像应用层或表示层那样，在其收到的数据前端附加首部或标签信息后再转发给下一层。而这些首部或标签中记录着数据传送顺序的信息。</p>
<p>到此为止，我们通过例子说明了在应用层写入的数据会经由表示层格式化编码、再由会话层标记发送顺序后才被发送出去的大致过程。然而，会话层只对何时建立连接、何时发送数据等问题进行管理，并不具有实际传输数据的功能。真正负责在网络上传输具体数据的是会话层以下各层。</p>
<p>传输层：</p>
<p>主机A确保与主机B之间的通信并准备发送数据。这一过程叫做“建立连接”。有了这个通信连接就可以使主机A发送的电子邮件到达主机B中，并由主机B 的邮件处理程序获取最终数据。此外，当通信传输结束后，有必要将连接断开。</p>
<p>如上，进行建立连接或断开连接的处理，在两个主机之间创建逻辑上的通信连接即是传输层的主要作用。此外，传输层为确保所传输的数据到达目标地址，会在通信两端的计算机之间进行确认，如果数据没有到达，它会负责进行重发。</p>
<p>例如，主机A将“早上好”这一数据发送给主机B。期间可能会因为某些原因导致数据被破坏，或由于发生某种网络异常致使只有一部分数据到达目标地址。假设主机B只收到了“早上”这一部分数据，那么它会在收到数据后将自己没有收到“早上”之后那部分数据的事实告知主机A，主机A得知这个情况后会将后面的“好”重发给主机B，并再次确认对端是否收到。</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140213150822.jpg" alt=""></p>
<p>由此可见，保证数据传输的可靠性是传输层的一个重要作用。为了确保可靠性，在这一层也会为所要传输的数据附加首部以识别这一分层的数据。然而，实际上将数据传输给对端的处理是由网络层来完成的。</p>
<p>网络层：</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140213150823.jpg" alt=""></p>
<p>网络层的作用是在网络与网络相互连接的环境中，将数据从发送端主机发送到接收端主机。两端主机之间虽然有众多数据链路，但能够将数据从主机A送到主机B也都是网络层的功劳，如下图所示：</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140213150824.jpg" alt=""></p>
<p>在实际发送数据时，目的地址至关重要。这个地址是进行通信的网络中唯一指定的序号。也可以把它想象为我们日常生活中使用的电话号码。只要这个目的地址确定了，就可以在众多计算机中选出该目标地址所对应的计算机发送数据。基于这个地址，就可以在网络层进行数据包的发送处理。而有了地址和网络层的包发送处理，就可以将数据发送到世界上任何一台互联设备。网络层中也会将其从上层收到的数据和地址信息等一起发送给下面的数据链路层，进行后面的处理。</p>
<p>数据链路层、物理层：</p>
<p>通信传输实际上是通过物理的传输介质实现的。数据链路层的作用就是在这些通过传输介质互联的设备之间进行数据处理。物理层中，将数据的0、1转换为电压和脉冲光传输给物理的传输介质，而相互直连的设备之间使用地址实现传输。而这种地址被成为MAC地址，也可称为物理地址或硬件地址。采用MAC地址，目的是为了识别连接到同一个传输介质上的设备。因此，在这一分层中将包含MAC地址信息的首部附加到从网络层转发过来的数据上，将其发送到网络。网络层与数据链路层都是基于目标地址将数据发送给接收端的，但是网络层负责将整个数据发送给最终目标地址，而数据链路层则只负责发送一个分段内的数据。</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/02/20140213150825.jpg" alt=""></p>
<p>主机B 端的处理：</p>
<p>接收端主机B 上的处理流程正好与主机A相反，它从物理层开始将接收到的数据逐层发给上一分层进行处理，从而使用户B 最终在主机B 上使用邮件客户端软件接收用户A 发送过来的邮件，并可以读取相应内容为“早上好”。</p>
<p>参考文献：</p>
<p>《图解TCP/IP：第5版》</p>
<p>&nbsp;</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-01-01T13:43:51.000Z"><a href="/2014/01/01/get-baidu-music-addr/">1月 1 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/01/01/get-baidu-music-addr/">获得百度无损品质音乐的下载地址</a></h1>
  

    </header>
    <div class="entry">
      
        <p>现在很多超高品质音乐都已开始收费了，百度也不例外。许多穷学生买不起会员，但是也想下载些无损品质音乐，怎么办呢？这里简单给个方法吧，包括获取方法，代码就不贴了。</p>
<p>1.首先选择一个音乐，在点击下载界面获取音乐的ID，如下图所示</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/01/20140101190532.jpg" alt=""></p>
<p>如《黑蝙蝠中队》的连接地址为：<a href="http://music.baidu.com/song/966991/download?__o=%2Fsearch" target="_blank" rel="external">http://music.baidu.com/song/966991/download?__o=%2Fsearch</a></p>
<p>我们记住这个歌曲的ID：966991（在song和download之间那个数字）</p>
<p>2.抓包解析，还是老方法，这里不说了，自己仔细分析即可，得到一个包含json串的地址：</p>
<p><a href="http://music.baidu.com/data/music/song?song_id=966991&amp;rate=921&amp;.r=0.181309352396056061388580827431" target="_blank" rel="external">http://music.baidu.com/data/music/song?song_id=966991&amp;rate=921&amp;.r=0.181309352396056061388580827431</a></p>
<p>记住rate后&amp;前的数字921。</p>
<p>3.打开上面的地址，查看json串里songLink里面对应的值，此值就是音乐的下载地址：<br><code>&quot;songLink&quot;: &quot;http:\/\/zhangmenshiting.baidu.com\/data2\/music\/33809115\/966991111600921.flac?xcode=8dd148655a820585261c4450f7f4304e9d0fba1db032ff5f&quot;</code><br>将\/\/转成正常的 / 就可以了。</p>
<p>4.如果想下载其他音乐，只需要按照第一步操作获取音乐的ID，然后构造下载地址，下载地址按照下面方面构造：<br><code>http://music.baidu.com/data/music/song?song_id=第一步获取的ID&amp;amp;rate=999&amp;amp;.r=0.181309352396056061388580827431</code><br>其中song_id等于第一步里面你获取的ID。然后在json串里得到下载地址就可以了。</p>
<p>说明：</p>
<p>rate后面那个数字代表音乐的品质，900以上的表示无损音乐，可以取任意值。8xx 7xx 一直往下知道1xx但不是固定，代表着超高，高和标准品质，但是不是完全固定。这里不详细查找了，代码也比较好写。分析就这样吧。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-01-01T10:58:42.000Z"><a href="/2014/01/01/windows-5037-questions/">1月 1 2014</a></time>
      
      
  
    <h1 class="title"><a href="/2014/01/01/windows-5037-questions/">找出大量TIME_WAIT及进程监听大量其他端口的罪魁祸首程序</a></h1>
  

    </header>
    <div class="entry">
      
        <p>刚才在windows下想查看某端口问题，于是命令netstat -an 查看了下，好家伙，竟然屏幕上显示不下端口连接监听情况，于是 netstat -an &gt;1.txt重定向看了下，发现是5037端口监听其他端口太多了。难道中毒了？于是自己查看了下，原来是腾讯手机连接助手搞的鬼。这里写点分析思路吧。</p>
<p>1.先查看都有哪些程序占用或监听5037端口，命令 netstat -ano | findstr  “5037”</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/01/20140101182952.jpg" alt=""></p>
<p>2.根据pid值，查看指定程序的进程，命令为：tasklist | findstr “4476”<br><code>C:\Users\Administrator&amp;gt;tasklist | findstr &quot;4476&quot;</code><br><code>tadb.exe 4476 Console 1 4,936 K</code><br>3.tadb.exe是啥玩意？全盘搜索下：</p>
<p>首先进入C盘根目录，然后运行命令，dir tadb.exe /s/a（此为全盘检索tadb.exe文件），我们查看下结果:</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/01/20140101182953.jpg" alt=""></p>
<p>一共找到了五个程序，仔细查看，我们发现该程序原来是腾讯的手机链接助手。这个如果你不爽的话，那杀掉此进程就是了。</p>
<p>4.强制杀掉进程及其子进程，命令：taskkill /f /t /im tadb.exe<br><code>C:\&gt;taskkill /f /t /im tadb.exe</code><br>成功: 已终止 PID 4476 (属于 PID 8032 子进程)的进程。<br>5.如果你想让删除此程序，我没测试，方法是安全模式，进入刚才找到的五个文件夹下，删掉这个文件，然后分别建个同名的文件，一般就可以。</p>
<p>当然你也可以这样，命令行下输入”gpedit.msc”，进入组策略编辑器，然后选择“用户配置-管理模板-系统”，双击右侧的“不要运行指定的windows应用程序”，在打开的对话框里，选择“已启用”，点击“不允许的应用程序的列表”后面的“显示”，在弹出的“显示内容”的对话框里把想要禁止的程序输入即可。我们把刚才找到的五个目录下的tadb.exe都输入进去，注意别忘了在目录后添加\tadb.exe。如图所示：</p>
<p><img src="http://armsword.com/wp-content/uploads/2014/01/20140101190522.jpg" alt=""></p>
<p>PS：现在移动端各大厂商斗争挺激烈的，各家程序也各种无底线啊，归根到底受害的还是用户。</p>
<p>PSS：发现第五种方法搞不定手机助手，现在这些互联网软件做的比病毒还霸道，真烦心。</p>
<p>最后，祝大家元旦快乐！</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-12-25T12:55:49.000Z"><a href="/2013/12/25/email-commentators/">12月 25 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/12/25/email-commentators/">让WordPress支持评论邮件通知功能</a></h1>
  

    </header>
    <div class="entry">
      
        <p>把disqus换掉了wordpress自带的评论系统，原因主要是那个邮件通知不及时，甚至有时候别人评论给我，我都收不到邮件提醒。本来还考虑多说呢，但是想想还是用自带的评论系统吧，之前我的博客说过一次，<a href="http://armsword.com/2012/11/02/add-a-comment-email-notification-feature.html" target="_blank" rel="external">http://armsword.com/2012/11/02/add-a-comment-email-notification-feature.html</a> 。这里我就用常见的插件吧，主要让该评论系统支持2个常用功能：</p>
<p>1.评论内容能及时发送到我的邮箱</p>
<p>2.我/别人回复时，评论者邮箱能收到我/别人的评论内容</p>
<p>说白了，就是让wordpress支持评论邮件提醒，这样大家的评论被回复时，能够及时看到。</p>
<p>这里需要安装2个插件，后台自己搜索就可以了：</p>
<p>1.Cimy Swift SMTP</p>
<p>安装完后，启用插件，之后在，左下角的设置里点击Cimy Swift SMTP进行设置，设置如下（注：我的独立域名邮箱使用的是QQ邮箱系统）</p>
<p><img src="http://armsword.com/wp-content/uploads/2013/12/20131225202708.jpg" alt=""></p>
<p>如果你使用的是Gmail邮箱，那么对应的设置应该为smtp.gmail.com 587 TLS加密，具体我没看，看官们可以自己试试，完事后在下放的Test Connection 里输入不同的邮箱，发送测试，如果配置正确，会出现TEST EMAIL SENT - Connection Verified等等字样。这个插件保证博主能收到别人的评论提醒，如果你想回复评论且让评论者收到你的评论，还需要安装第二个插件。</p>
<p>2.Comment Reply Notification</p>
<p>后台搜索下此插件，安装完后，启动此插件，之后点击左下角设置里对应的Comment Reply Notification选项，按照下图设置下就可以了。</p>
<p><img src="http://armsword.com/wp-content/uploads/2013/12/20131225202709.jpg" alt=""></p>
<p>如果想让评论者邮箱收到博主/别人的评论，以上两个插件是必须都安装的。</p>
<p>PS：这两个插件都安装后，当别人博客引用你的博客文章链接的时候，也会出现邮件提醒的哦~</p>
<p>&nbsp;</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-12-23T15:57:14.000Z"><a href="/2013/12/23/mysql-has-gone-away/">12月 23 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/12/23/mysql-has-gone-away/">说说MySQL server has gone away的几种解决办法</a></h1>
  

    </header>
    <div class="entry">
      
        <p>涉及到MySQL数据库的后台开发，经常会遇到一个问题，MySQL server has gone away，官网上给出一些原因和解决办法，见此处：<a href="http://dev.mysql.com/doc/refman/5.0/en/gone-away.html" target="_blank" rel="external">http://dev.mysql.com/doc/refman/5.0/en/gone-away.html</a> ，最近我的程序也遇到了这个问题，自己通过搜索以及与实验室学长讨论，简单总结下解决办法吧。</p>
<p>1.应用程序长时间的执行批量的MYSQL语句。</p>
<p>解决方案：</p>
<p>在my.cnf文件中添加或者修改以下两个变量：</p>
<p>wait_timeout=2880000</p>
<p>interactive_timeout = 2880000</p>
<p>2.执行一个SQL，但SQL语句过大或者语句中含有BLOB或者longblob字段。比如，图片数据的处理.</p>
<p>解决方案：</p>
<p>在my.cnf文件中添加或者修改以下变量：</p>
<p>max_allowed_packet = 10M(也可以设置自己需要的大小)</p>
<p>max_allowed_packet参数的作用是，用来控制其通信缓冲区的最大长度。</p>
<p>3.C程序解决办法是调用 mysql_options ，将MYSQL_OPT_RECONNECT设置为1</p>
<p>如果1、2两种方法没解决问题，依然出现”MySQL has gone away”，那么试试调用mysql_options函数：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">char</span> <span class="keyword">value</span> = <span class="number">1</span>;</div><div class="line">mysql_options(mysql, MYSQL_OPT_RECONNECT, &amp;<span class="keyword">value</span>);</div></pre></td></tr></table></figure>

<p>mysql_options函数的位置在mysql_real_connect()函数之后和mysql_query()函数之前，如下所示：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql_real_connect(mysql, <span class="string">"127.0.0.1"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>, <span class="string">"test"</span>, <span class="number">3306</span>, <span class="literal">NULL</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line">//do something</div><div class="line"> char value = <span class="number">1</span>;</div><div class="line"> mysql_options(mysql, MYSQL_OPT_RECONNECT, &amp;value);</div><div class="line"></div><div class="line"> //do something</div><div class="line"> mysql_query(<span class="keyword">...</span>);</div></pre></td></tr></table></figure>

<p>4.MySQL has gone away也可能是因为MySQL不能通过mysql.sock连接问题造成的</p>
<p>我的程序以上三种方法问题都没解决，最后师兄说可能是mysql不能通过mysql.sock连接，于是测试了下，命令查看配置文件，</p>
<p>cat /etc/my.cnf，查看”socket=”后面的字符串，我所在的测试机的值为”/var/lib/mysql/mysql.sock”。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql_real_connect(mysql, <span class="string">"127.0.0.1"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>, <span class="string">"test"</span>, <span class="number">3306</span>, <span class="keyword">NULL</span>, <span class="number">0</span>);</div></pre></td></tr></table></figure>

<p>修改为</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql_real_connect(mysql, <span class="string">"127.0.0.1"</span>, <span class="string">"root"</span>, <span class="string">"123456"</span>, <span class="string">"test"</span>, <span class="number">3306</span>, <span class="string">"/var/lib/mysql/mysql.sock"</span>, <span class="number">0</span>);</div></pre></td></tr></table></figure>

<p>问题解决。</p>
<p>参考链接：</p>
<p><a href="http://www.felix021.com/blog/read.php?2102" target="_blank" rel="external">http://www.felix021.com/blog/read.php?2102</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-12-05T11:27:16.000Z"><a href="/2013/12/05/regular-expression-operations/">12月 5 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/12/05/regular-expression-operations/">Regular expression operations</a></h1>
  

    </header>
    <div class="entry">
      
        <p>之前接触过正则表达式，但是用的不熟练，原因主要是自己一直用C/C++开发，用正则时候比较少，所以也就没有达到熟能生巧的地步。这几天，用python做点东西，需要用到正则，python在文本处理方面是一把利器，你懂的，所以，就把网上那个非常有名的《正则表达式30分钟入门教程》和《python 正则表达式指南》重温了下，这里把里面的内容摘抄下，主要是方便自己查阅。</p>
<p><img src="http://armsword.com/wp-content/uploads/2013/12/201312502.png" alt=""><br><img src="http://armsword.com/wp-content/uploads/2013/12/201312504.png" alt=""><br><img src="http://armsword.com/wp-content/uploads/2013/12/201312506.png" alt=""><br><img src="http://armsword.com/wp-content/uploads/2013/12/201312508.png" alt=""></p>
<p>由于我们使用python的正则，不同语言下，正则是稍微有些差异的。这里贴个网友们整理的python下的正则语法图片。我仔细看下，应该是参考<a href="http://docs.python.org/2/library/re.html#module-re" target="_blank" rel="external">http://docs.python.org/2/library/re.html#module-re</a> 这里的，不过挺一目了然的。水印是原博主的博客地址，后面我也会放出地址，想看完整版的可以去查看原帖。</p>
<p><img src="http://armsword.com/wp-content/uploads/2013/12/pyre.png" alt=""></p>
<p>参考链接：</p>
<p><a href="http://www.cnblogs.com/huxi/archive/2010/07/04/1771073.html" target="_blank" rel="external">《Python正则表达式指南》</a></p>
<p><a href="http://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="external">《正则表达式30分钟入门指南》</a></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



<nav id="pagination">
  
    <a href="/page/3/" class="alignleft prev">上一页</a>
  
  
    <a href="/page/5/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:armsword.com">
  </form>
</div>


  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/C-C/">C/C++</a><small>22</small></li>
  
    <li><a href="/categories/Database/">Database</a><small>2</small></li>
  
    <li><a href="/categories/Linux/">Linux</a><small>13</small></li>
  
    <li><a href="/categories/ML-NLP/">ML/NLP</a><small>3</small></li>
  
    <li><a href="/categories/Python/">Python</a><small>2</small></li>
  
    <li><a href="/categories/SDK-MFC/">SDK/MFC</a><small>3</small></li>
  
    <li><a href="/categories/我的生活/">我的生活</a><small>4</small></li>
  
    <li><a href="/categories/算法-数据结构/">算法/数据结构</a><small>4</small></li>
  
    <li><a href="/categories/计算机网络/">计算机网络</a><small>9</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2015/01/26/jwsmtp-analyse/">jwSMTP源码剖析</a>
      </li>
    
      <li>
        <a href="/2014/12/01/learn-emacs-note/">Emacs学习笔记</a>
      </li>
    
      <li>
        <a href="/2014/11/22/move-from-wordpress-to-hexo/">将WordPress迁移到hexo并同时托管到Github和Gitcafe上</a>
      </li>
    
      <li>
        <a href="/2014/11/07/finding-job-result/">一蓑烟雨任平生</a>
      </li>
    
      <li>
        <a href="/2014/10/29/tinyhttpd-code-analyse/">tinyhttpd源码剖析</a>
      </li>
    
      <li>
        <a href="/2014/10/26/webbench-source-analyse/">Webbench源码剖析</a>
      </li>
    
      <li>
        <a href="/2014/09/04/redis-ae-analyse/">Redis AE事件库源码剖析</a>
      </li>
    
  </ul>
</div>



  

  <div class="widget tag">
<h3 class="title">友情链接</h3>
<ul class="entry">
<li><a href="http://linuxer.me" target="_blank" title="armsword的涅槃之地">armsword</a></li>
<li><a href="http://yanyiwu.com" target="_blank" title="YanYi">YanYi</a></li>
<li><a href="http://dreamshield.net/" target="_blank" title="DreamShield">DreamShield</a></li>
<li><a href="http://blog.purplecow.me" target="_blank" title="PurpleCow">PurpleCow</a></li>
<li><a href="http://cstdlib.com" target="_blank" title="徐小夫">徐小夫</a></li>
</ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft"> 
  
  &copy; 2015 armsword
  
</div>
 || 
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253622272'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1253622272' type='text/javascript'%3E%3C/script%3E"));</script>


<div class="clearfix"></div>
</footer>
  <script src="/js/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="totop" style="position:fixed;bottom:30px;right:30px;cursor: pointer;">
<a title="返回顶部"><img src="/imgs/scrollup.png"/></a>
</div>

<script src="/js/totop.js"></script>


</body>
</html>